<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin. | Productos</title>
    <link rel="stylesheet" href="css/index.css" />
    <link rel="stylesheet" href="css/feather.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Urbanist:ital,wght@0,500;0,600;0,700;0,800;1,500&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"
      integrity="sha512-odNmoc1XJy5x1TMVMdC7EMs3IVdItLPlCeL5vSUPN2llYKMJ2eByTTAIiiuqLg+GdNr9hF6z81p27DArRFKT7A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>
  <body onload="getUser()">
    <%- include("../partials/navbar.ejs") %>

    <!-- HEADER NAV -->
    <header class="header">
      <div class="header__left">
        <h1>Productos</h1>
        <p>Manejá el stock de tus productos, todo en el mismo lugar.</p>
      </div>
      <div class="header__right">
        <div class="header__action header__action--search">
          <i class="feather icon-search"></i>
          <input type="search" placeholder="Buscar en el panel" />
          <button class="filter__button">
            <i class="feather icon-sliders"></i>
          </button>
        </div>
        <div class="header__profile">
          <button class="header__action" id="toggleChat">
            <i class="feather icon-message-square"
              ><span class="header__action--badge" id="msgQuantity"></span
            ></i>
          </button>
          <button class="header__action" onclick="logout()">
            <i class="feather icon-log-out"></i>
          </button>
          <a href="" class="header__action header__action--profile">
            <img
              id="userImg"
              src=""
              alt="Imagen de perfil"
            />
          </a>
        </div>
      </div>
      <!-- CHAT -->
      <div class="chat">
        <div class="chat__header">
          <h5>Chat del equipo</h5>
        </div>
        <ul class="chat__main" id="chatList"></ul>
        <div class="chat__reply">
          <form id="sendMessage" class="flex-column gap-1">
            <input
              type="email"
              name="email"
              class="form__input"
              placeholder="ejemplo@gmail.com"
              required
            />
            <input
              type="text"
              name="message"
              id="message"
              class="form__input"
              placeholder="Mensaje"
              required
            />
            <button class="btn__action" type="submit">
              <div class="hover">
                <i class="feather icon-mail"></i> <span>Enviar mensaje</span>
              </div>
            </button>
          </form>
        </div>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main" id="main">
      <div class="products__list">
        <table>
          <thead>
            <tr>
              <th>
                <label class="flex-row jc-center align-center gap-1">
                  Seleccionar
                  <input type="checkbox" class="checkbox" />
                </label>
              </th>
              <th>Imágen del producto</th>
              <th>Nombre del producto</th>
              <th>Precio</th>
              <th>Acción</th>
            </tr>
          </thead>
          <tbody id="productsList"></tbody>
        </table>
        <!-- <h3 class="text-center text-xl">No tienes productos en stock! Agrega desde
              <a class="link font-bold" href="AgregarProducto">aquí</a></h3> -->
      </div>
      <div class="products__form flex-column gap-2">
        <h2>Agregar Producto</h2>
        <form class="form flex-column gap-2" id="formAddProduct">
          <div class="form__group">
            <label for="code">Código del producto</label>
            <input type="text" name="code" id="code" class="form__input" />
          </div>
          <div class="form__group">
            <label for="title">Nombre del producto</label>
            <input type="text" name="title" id="title" class="form__input" />
          </div>
          <div class="form__group">
            <label for="price">Precio</label>
            <input type="number" name="price" id="price" class="form__input" />
          </div>
          <div class="form__group">
            <label for="description">Descripción</label>
            <textarea name="description" id="description" class="form__input"></textarea>
          </div>
          <div class="form__group">
            <label for="urlImg">Url de la Imágen del producto</label>
            <input type="url" name="urlImg" id="urlImg" class="form__input" />
          </div>
          <div class="form__group">
            <label for="stock">Stock disponible</label>
            <input type="number" name="stock" id="stock" class="form__input" />
          </div>
          <button class="btn__action">
            <div class="hover">
              <i class="feather icon-plus"></i> <span>Agregar</span>
            </div>
          </button>
        </form>
      </div>
    </main>

    <script src="js/ui.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/chat.js" type="module"></script>
    <script src="js/products.js" type="module"></script>

    <script>
      let userLogued;

      const getUser = () => {
        axios
          .get('http://localhost:8080/api/auth/user-logued')
          .then((resp) => {
            console.log(resp)
            if (!resp.data.success) {
              console.log("hola")
              window.location.href = '/IniciarSesion';
              return;
            }
            userLogued = resp.data.data;
            userImg.setAttribute(
              'src',
              `http://localhost:8080/api/uploads/image/${userLogued.avatar}`
            );
          })
          .catch((error) => {
            console.log(error);
            window.location.href = '/IniciarSesion';
          });
      };

      const logout = () => {
        axios
          .delete('http://localhost:8080/api/auth/logout')
          .then((resp) => {
            console.log(resp);

            if (resp.data.success) {
                window.location.href = '/IniciarSesion';
            }
          })
          .catch((error) => {
            console.log(error);
          });
      };
    </script>

</html>
